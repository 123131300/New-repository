<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>üê≠ Mouse & Cheese ‚Äî Mini</title>
<style>
  /* ---------- Design System (responsive, light/dark) ---------- */
  :root{
    --bg: #0b1220;           /* dark */
    --elev: #111a2b;
    --panel: #0f172a;
    --text: #e6edf7;
    --muted: #9fb1cc;
    --primary: #4f8cff;
    --primary-2: #6d5cff;
    --good: #22c55e;
    --bad: #ef4444;
    --ring: #2b3b5f;
    color-scheme: dark;
  }
  html.light{
    --bg: #f6f8fc;           /* light */
    --elev: #ffffff;
    --panel: #ffffff;
    --text: #0b1220;
    --muted: #4a5568;
    --primary: #2563eb;
    --primary-2: #7c3aed;
    --good: #16a34a;
    --bad: #dc2626;
    --ring: #dbe3f2;
    color-scheme: light;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family: ui-sans-serif,system-ui,"Segoe UI",Roboto,Helvetica,Arial; background:var(--bg); color:var(--text);}
  .wrap{max-width:900px;margin:0 auto;padding:clamp(12px,2.5vw,20px);}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between;position:sticky;top:0;background:linear-gradient(180deg,var(--bg) 60%, transparent); padding-top:8px; z-index:5}
  .title{display:flex;align-items:center;gap:10px;font-size:clamp(18px,3.8vw,26px);font-weight:800}
  .chip{border:1px solid var(--ring); padding:.5em .9em;border-radius:999px;background:var(--elev);color:var(--text);font-weight:700; font-size:14px}
  .chips{display:flex;gap:8px}
  .hidden{display:none !important}

  /* Panels */
  .panel{background:var(--panel);border-radius:18px; box-shadow:0 6px 24px rgba(0,0,0,.25); padding:clamp(14px,2.4vw,20px);}
  .h1{font-size:clamp(22px,4.2vw,30px);font-weight:900;margin:12px 0}
  .h2{font-size:clamp(16px,3.4vw,22px);font-weight:800;margin:6px 0 12px}
  .p{color:var(--muted);font-size:clamp(13px,2.6vw,16px)}

  /* Progress header */
  .grid-header{display:grid;grid-template-columns: 1fr; gap:14px}
  .progressCard{display:grid;grid-template-columns:auto 1fr;gap:18px;align-items:center}
  .ring{inline-size:96px; aspect-ratio:1; border-radius:50%; display:grid; place-items:center; background:
        conic-gradient(var(--primary) var(--deg,10deg), var(--ring) 0);} 
  .ring-inner{background:var(--bg); inline-size:76px; aspect-ratio:1; border-radius:50%; display:grid;place-items:center; color:var(--text); font-weight:900; font-size:34px; box-shadow:inset 0 0 0 10px var(--ring)}
  .stats{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px}
  .pill{background:var(--elev); border:1px solid var(--ring); border-radius:14px; padding:14px; text-align:center}
  .pill .n{font-size:clamp(18px,3.6vw,22px); font-weight:900}
  .pill .k{color:var(--muted); font-weight:700; letter-spacing:.2px}

  /* Menu blocks */
  .blocks{display:grid; gap:14px}
  .block{display:flex; align-items:center; justify-content:space-between; gap:18px; padding:18px 16px; background:var(--panel); border-radius:16px; border:1px solid var(--ring)}
  .b-title{font-size:clamp(18px,3.4vw,22px); font-weight:900}
  .b-sub{color:var(--muted)}
  .btn{appearance:none;border:none; background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:white; padding:12px 18px; border-radius:12px; font-weight:900; letter-spacing:.2px; box-shadow:0 6px 20px rgba(79,140,255,.35);}
  .btn:active{transform:translateY(1px)}
  .btn.outline{background:transparent;color:var(--text);border:1px solid var(--ring);box-shadow:none}
  .btn.ghost{background:var(--elev)}

  /* Tabs / sections */
  section{display:none}
  section.active{display:block}

  /* Subscreens common */
  .card{padding:18px; border:1px solid var(--ring); border-radius:18px; background:var(--panel)}
  .row{display:flex; gap:12px; flex-wrap:wrap}
  .row.center{justify-content:center}
  .row.space{justify-content:space-between}
  .word{font-size:clamp(42px,10vw,80px); font-weight:900; letter-spacing:.5px}
  .word-ru{color:var(--muted); font-size:clamp(16px,4vw,22px); margin-top:4px}
  .subhead{font-size:clamp(14px,3.2vw,16px); color:var(--muted); margin-bottom:8px; font-weight:700}

  /* Quiz */
  .quiz-grid{display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px}
  .option{padding:14px 16px; border-radius:12px; border:1px solid var(--ring); background:var(--elev); font-weight:800; text-align:center}
  .option.correct{background:rgba(34,197,94,.15);border-color:var(--good)}
  .option.wrong{background:rgba(239,68,68,.15);border-color:var(--bad)}

  /* Game */
  .game-wrap{display:flex; flex-direction:column; gap:12px}
  .board{position:relative; border:1px dashed var(--ring); border-radius:16px; overflow:hidden; background:linear-gradient(0deg, transparent 24px, var(--ring) 24px),
          linear-gradient(90deg, transparent 24px, var(--ring) 24px); background-size:48px 48px; background-position: -1px -1px; min-block-size:320px; aspect-ratio: 4/5}
  .sprite{position:absolute; font-size: clamp(28px,7vw,42px); transform:translate(-50%,-50%)}
  .note{color:var(--muted)}

  /* Accent (Pronunciation) */
  .meter{padding:12px 14px; border:1px solid var(--ring); border-radius:12px; background:var(--elev); font-weight:700}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}

  /* Bottom nav */
  .tabbar{position:sticky; bottom:0; inset-inline:0; background:linear-gradient(180deg, transparent, rgba(0,0,0,.08) 30%, var(--bg)); padding-top:8px}
  .tabs{display:grid; grid-template-columns: repeat(4,1fr); gap:8px}
  .tab{padding:10px 8px; text-align:center; border-radius:12px; background:var(--elev); border:1px solid var(--ring); font-weight:900}
  .tab.active{outline:2px solid var(--primary)}

  @media (min-width:640px){
    .grid-header{grid-template-columns: 320px 1fr}
  }
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <div class="title">üê≠ <span>Mouse & Cheese</span></div>
    <div class="chips">
      <button class="chip" id="themeBtn">Theme</button>
      <button class="chip" data-go="home">Menu</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="home" class="active">
    <div class="grid-header">
      <div class="panel progressCard">
        <div class="ring" id="ring" style="--deg: 18deg"><div class="ring-inner" id="todayCounter">1</div></div>
        <div>
          <div class="h2" style="margin:0 0 6px">Goal: 20/day</div>
          <div class="p">Move toward your goal ‚Äî practice every day.</div>
          <div class="stats" style="margin-top:12px">
            <div class="pill"><div class="n" id="statCards">0</div><div class="k">Cards</div></div>
            <div class="pill"><div class="n" id="statQuiz">0</div><div class="k">Quiz</div></div>
            <div class="pill"><div class="n" id="statCheese">0</div><div class="k">Cheese</div></div>
            <div class="pill"><div class="n" id="statAccent">0</div><div class="k">Accent</div></div>
          </div>
        </div>
      </div>
      <div class="blocks">
        <div class="block">
          <div>
            <div class="b-title">Quiz</div>
            <div class="b-sub">Pick the correct translation</div>
          </div>
          <button class="btn" data-go="quiz">Open ‚Üí</button>
        </div>
        <div class="block">
          <div>
            <div class="b-title">Cards</div>
            <div class="b-sub">EN ‚áÑ RU. ‚ÄúKnow‚Äù adds to learned</div>
          </div>
          <button class="btn" data-go="cards">Open ‚Üí</button>
        </div>
        <div class="block">
          <div>
            <div class="b-title">Game</div>
            <div class="b-sub">Eat cheese ‚Äî beep + word</div>
          </div>
          <button class="btn" data-go="game">Open ‚Üí</button>
        </div>
        <div class="block">
          <div>
            <div class="b-title">Accent</div>
            <div class="b-sub">Say the word close to native</div>
          </div>
          <button class="btn" data-go="accent">Train ‚Üí</button>
        </div>
      </div>
    </div>

    <div class="tabbar">
      <div class="tabs">
        <button class="tab" data-go="quiz">üß†</button>
        <button class="tab" data-go="cards">üÉè</button>
        <button class="tab" data-go="game">üéÆ</button>
        <button class="tab" data-go="accent">üí¨</button>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="quiz">
    <div class="card">
      <div class="subhead">Quiz ‚Äî choose the translation</div>
      <div class="word" id="quizWord">word</div>
      <div class="quiz-grid" id="quizOptions"></div>
      <div class="row space" style="margin-top:12px">
        <button class="btn outline" data-go="home">Menu</button>
        <button class="btn" id="quizNext">Next</button>
      </div>
    </div>
  </section>

  <!-- CARDS -->
  <section id="cards">
    <div class="card">
      <div class="subhead">Cards</div>
      <div class="word" id="cardWord">‚Äî</div>
      <div class="word-ru" id="cardRu" style="opacity:.85">tap ‚ÄúShow RU‚Äù</div>
      <div class="row center" style="margin-top:12px">
        <button class="btn outline" id="cardShow">Show RU</button>
        <button class="btn ghost" id="cardSpeak">Speak</button>
        <button class="btn good" id="cardKnow" style="background:var(--good)">Know</button>
        <button class="btn" id="cardNext">Next</button>
      </div>
      <div class="row center" style="margin-top:10px">
        <button class="btn outline" data-go="home">Menu</button>
      </div>
    </div>
  </section>

  <!-- GAME -->
  <section id="game">
    <div class="game-wrap">
      <div class="row space">
        <button class="btn outline" id="gRestart">Restart</button>
        <button class="btn outline" data-go="home">Menu</button>
      </div>
      <div class="board" id="board">
        <div class="sprite" id="mouse">üê≠</div>
        <div class="sprite" id="cheese">üßÄ</div>
      </div>
      <div class="note p">Swipe to move. Tap to turn towards cheese. Eat cheese ‚Äî ‚Äúbeep‚Äù and the word.</div>
    </div>
  </section>

  <!-- ACCENT -->
  <section id="accent">
    <div class="card">
      <div class="subhead">Pronunciation ‚Ä¢ say the word as close as you can</div>
      <div class="word" id="accWord">‚Äî</div>
      <div class="word-ru" id="accRu">‚Äî</div>
      <div class="row center" style="margin-top:10px">
        <button class="btn outline" id="accListen">Listen</button>
        <button class="btn" id="accSay">Say (browser)</button>
      </div>
      <div class="row center" style="margin-top:10px">
        <button class="btn outline" data-go="home">Menu</button>
        <button class="btn" id="accNext">Next</button>
      </div>
      <div class="meter" id="micState" style="margin-top:12px">Mic: ‚Äî</div>
      <div class="row space" style="margin-top:10px">
        <div class="meter mono" style="flex:1" id="heard">Heard: ‚Äî</div>
        <div class="meter" style="min-width:160px" id="score">Match: 0%</div>
      </div>
    </div>
  </section>

</div>

<script>
// ---------- Data ----------
const PAIRS = [
  {en:'cheese', ru:'—Å—ã—Ä'}, {en:'bread', ru:'—Ö–ª–µ–±'}, {en:'milk', ru:'–º–æ–ª–æ–∫–æ'}, {en:'water', ru:'–≤–æ–¥–∞'},
  {en:'computer', ru:'–∫–æ–º–ø—å—é—Ç–µ—Ä'}, {en:'child', ru:'—Ä–µ–±—ë–Ω–æ–∫'}, {en:'room', ru:'–∫–æ–º–Ω–∞—Ç–∞'}, {en:'right', ru:'–ø—Ä–∞–≤–æ'},
  {en:'left', ru:'–ª–µ–≤–æ'}, {en:'ticket', ru:'–±–∏–ª–µ—Ç'}, {en:'help', ru:'–ø–æ–º–æ–≥–∞—Ç—å'}, {en:'friend', ru:'–¥—Ä—É–≥'},
  {en:'hotel', ru:'–æ—Ç–µ–ª—å'}, {en:'direction', ru:'–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ'}, {en:'luggage', ru:'–±–∞–≥–∞–∂'}
];

// Persistent progress
const store = {
  get known(){return JSON.parse(localStorage.getItem('known_v1')||'[]')},
  set known(v){localStorage.setItem('known_v1', JSON.stringify(v))},
  get stats(){return JSON.parse(localStorage.getItem('stats_v1')||'{"cards":0,"quiz":0,"cheese":0,"accent":0,"today":1}')},
  set stats(v){localStorage.setItem('stats_v1', JSON.stringify(v))}
};

// Utility
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
function show(id){ $$('section').forEach(s=>s.classList.remove('active')); $('#'+id).classList.add('active'); }
function speak(txt){
  const u = new SpeechSynthesisUtterance(txt);
  u.lang = 'en-US';
  u.rate = 0.95; u.pitch = 1.02; u.volume = 1;
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}
function beep(){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type='sine'; o.frequency.setValueAtTime(880, ctx.currentTime);
  g.gain.setValueAtTime(0.2, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.2);
  o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.21);
}
// Similarity (Jaro‚ÄìWinkler simplified)
function sim(a,b){a=a.toLowerCase(); b=b.toLowerCase(); const m=Math.min(a.length,b.length); if(!m)return 0; let matches=0, trans=0; const window=Math.floor(Math.max(a.length,b.length)/2)-1; const aFlag=[], bFlag=[]; for(let i=0;i<a.length;i++){const start=Math.max(0,i-window), end=Math.min(i+window+1,b.length); for(let j=start;j<end;j++){if(bFlag[j])continue; if(a[i]===b[j]){aFlag[i]=bFlag[j]=true; matches++; break;}}}
 if(!matches) return 0; let k=0; for(let i=0;i<a.length;i++){ if(!aFlag[i]) continue; while(!bFlag[k]) k++; if(a[i]!==b[k]) trans++; k++; }
 const j = (matches/a.length + matches/b.length + (matches-trans/2)/matches)/3; // jaro
 const p=0.1; let l=0; while(l<4 && a[l]===b[l]) l++; return (j + l*p*(1-j));
}

// Routing
$$('[data-go]').forEach(b=>b.addEventListener('click', e=>{show(e.currentTarget.dataset.go)}));
$('#themeBtn').addEventListener('click',()=>{document.documentElement.classList.toggle('light');});

// ---------- Dashboard ----------
function refreshStats(){
  const s = store.stats; $('#statCards').textContent = s.cards; $('#statQuiz').textContent = s.quiz; $('#statCheese').textContent = s.cheese; $('#statAccent').textContent = s.accent; $('#todayCounter').textContent = s.today||1; const pct=Math.min(360,(s.cards+s.quiz+s.cheese+s.accent)/20*360); $('#ring').style.setProperty('--deg', pct+'deg');
}
refreshStats();

// ---------- Cards ----------
let idxCards = Math.floor(Math.random()*PAIRS.length);
function setCard(){ const p = PAIRS[idxCards]; $('#cardWord').textContent=p.en; $('#cardRu').textContent='tap ‚ÄúShow RU‚Äù'; $('#cardRu').style.opacity=.85; }
setCard();
$('#cardShow').onclick = ()=>{ $('#cardRu').textContent = PAIRS[idxCards].ru; };
$('#cardSpeak').onclick = ()=> speak(PAIRS[idxCards].en);
$('#cardNext').onclick = ()=>{ idxCards = (idxCards+1)%PAIRS.length; setCard(); };
$('#cardKnow').onclick = ()=>{ const k = store.known; const en=PAIRS[idxCards].en; if(!k.includes(en)) k.push(en); store.known = k; const s=store.stats; s.cards++; store.stats=s; refreshStats(); idxCards=(idxCards+1)%PAIRS.length; setCard(); };

// ---------- Quiz ----------
let qIndex = 0, qAnswer = '';
function nextQuiz(){ const p=PAIRS[qIndex = (qIndex+1)%PAIRS.length]; $('#quizWord').textContent=p.en; qAnswer = p.ru; const opts = new Set([p.ru]); while(opts.size<4){ const r = PAIRS[Math.floor(Math.random()*PAIRS.length)].ru; opts.add(r)} const arr=[...opts].sort(()=>Math.random()-0.5); const box=$('#quizOptions'); box.innerHTML=''; arr.forEach(txt=>{ const b=document.createElement('button'); b.className='option'; b.textContent=txt; b.onclick=()=>{ if(b.dataset.lock)return; b.dataset.lock=1; [...box.children].forEach(c=>c.disabled=true); const ok = (txt===qAnswer); b.classList.add(ok?'correct':'wrong'); const s=store.stats; if(ok){ s.quiz++; store.stats=s; refreshStats(); beep(); speak(PAIRS[qIndex].en);} else { /*no stat on wrong*/ } }; box.appendChild(b); }); }
$('#quizNext').onclick = ()=> nextQuiz();
nextQuiz();

// ---------- Game ----------
const board = $('#board'); const mouse = $('#mouse'); const cheese = $('#cheese');
let m={x:50,y:50, size:1}, c={x:20,y:20};
function place(sprite, obj){ sprite.style.left=obj.x+'%'; sprite.style.top=obj.y+'%'; sprite.style.transform=`translate(-50%,-50%) scale(${obj.size||1})`; }
function rnd(){ return 10 + Math.random()*80; }
function resetGame(){ m={x:50,y:50,size:1}; c={x:rnd(), y:rnd()}; place(mouse,m); place(cheese,c); }
resetGame();
$('#gRestart').onclick=resetGame;

function step(dx,dy){ m.x=Math.max(5,Math.min(95,m.x+dx)); m.y=Math.max(5,Math.min(95,m.y+dy)); place(mouse,m); const dist=Math.hypot(m.x-c.x, m.y-c.y); if(dist<6){ // eat
   beep(); const w = PAIRS[Math.floor(Math.random()*PAIRS.length)].en; speak(w); const s=store.stats; s.cheese++; store.stats=s; refreshStats(); m.size=Math.min(1.8, m.size+0.05); place(mouse,m); c={x:rnd(),y:rnd()}; place(cheese,c);
 }}
// Touch controls
let t0=null; board.addEventListener('touchstart',e=>{t0=e.touches[0]});
board.addEventListener('touchmove',e=>{ if(!t0) return; const t=e.touches[0]; const dx=t.clientX-t0.clientX, dy=t.clientY-t0.clientY; const ax=Math.abs(dx), ay=Math.abs(dy); if(ax>20||ay>20){ if(ax>ay) step(dx>0?3:-3,0); else step(0, dy>0?3:-3); t0=t; } });
board.addEventListener('touchend',()=>t0=null);
// Tap: face the cheese by snapping closer
board.addEventListener('click',()=>{ const dx = c.x>m.x?3:-3; const dy = c.y>m.y?3:-3; step(dx,dy) });

// ---------- Accent (Pronunciation) ----------
let aIndex = Math.floor(Math.random()*PAIRS.length);
function setAccent(){ const p=PAIRS[aIndex]; $('#accWord').textContent=p.en; $('#accRu').textContent=p.ru; $('#heard').textContent='Heard: ‚Äî'; $('#score').textContent='Match: 0%'; }
setAccent();
$('#accNext').onclick = ()=>{ aIndex=(aIndex+1)%PAIRS.length; setAccent(); };
$('#accListen').onclick = ()=> speak(PAIRS[aIndex].en);

// STT via Web Speech (browser)
let recog, micReady=false; function ensureRecog(){ try{ const WSR = window.SpeechRecognition||window.webkitSpeechRecognition; if(!WSR) return null; if(!recog){ recog = new WSR(); recog.lang='en-US'; recog.interimResults=false; recog.maxAlternatives=1; recog.onresult = (e)=>{ const heard = e.results[0][0].transcript; $('#heard').textContent = 'Heard: '+heard; const target = PAIRS[aIndex].en; const pct = Math.round(sim(heard, target)*100); $('#score').textContent = 'Match: '+pct+'%'; if(pct>=65){ const s=store.stats; s.accent++; store.stats=s; refreshStats(); }
      };
      recog.onstart=()=>{$('#micState').textContent='Mic: listening‚Ä¶'}; recog.onend=()=>{$('#micState').textContent='Mic: ready'}; }
    micReady=true; $('#micState').textContent='Mic: ready'; return recog; }catch(err){ console.warn(err); $('#micState').textContent='Mic: not available'; return null; }}

$('#accSay').onclick = ()=>{ const r=ensureRecog(); if(r){ r.stop(); r.start(); } };

// ---------- Nav helpers ----------
function activateTabBySection(){ const sec = $$('section').find(s=>s.classList.contains('active')); $$('.tab').forEach(t=>t.classList.remove('active')); if(!sec||sec.id==='home') return; const map={quiz:0,cards:1,game:2,accent:3}; const i=map[sec.id]; if(i!=null) $$('.tab')[i].classList.add('active'); }
window.addEventListener('click', activateTabBySection, true);

// Start with light theme if OS prefers
if(matchMedia('(prefers-color-scheme: light)').matches) document.documentElement.classList.add('light');

</script>
</body>
</html>
