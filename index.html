<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>Mouse & Cheese</title>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <style>
    :root{
      --bg:#edf1f7;--panel:#ffffff;--ink:#111827;--muted:#5b6575;--ring:#e5e9f2;
      --accent1:#5865f2;--accent2:#7c3aed;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;
      --chip:#f4f6fb;--shadow:0 10px 30px rgba(16,24,40,.08);
      --radius:18px;--rsm:12px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";color:var(--ink);background:linear-gradient(180deg,#f6f8fc, #eef1f7)}
    #root{min-height:100vh;display:flex;justify-content:center;padding:18px}
    .wrap{width:min(1100px,100%)}
    h1{margin:0 0 14px;display:flex;align-items:center;gap:10px;font-size:28px}
    .topbar{display:flex;gap:10px;justify-content:flex-end}
    .btn{appearance:none;border:0;background:#fff;border-radius:999px;padding:10px 18px;font-weight:600;box-shadow:var(--shadow);cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn--grad{color:#fff;background:linear-gradient(90deg,var(--accent1),var(--accent2))}
    .btn--ok{color:#fff;background:var(--ok)}
    .btn--ghost{background:#fff}
    .panel{background:var(--panel);box-shadow:var(--shadow);border-radius:var(--radius);padding:22px;margin:18px 0}
    .grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .metric{background:#f5f7fc;border-radius:16px;padding:12px;text-align:center}
    .metric b{font-size:22px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .title{font-size:22px;font-weight:800;margin:0 0 12px}
    .subtitle{color:var(--muted);margin:6px 0 0}
    .card-row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{background:#f5f7fc;border-radius:999px;padding:10px 16px}
    .cta{padding:12px 18px;border-radius:14px}
    .nav{position:sticky;bottom:8px;display:flex;justify-content:space-between;gap:12px}
    .nav button{flex:1;padding:12px;border-radius:14px;background:#fff;box-shadow:var(--shadow)}

    /* QUIZ */
    .quiz-word{font-size:64px;font-weight:900;margin:8px 0 16px}
    .ans{padding:14px 16px;border-radius:14px;border:1px solid var(--ring);background:#fff;cursor:pointer}
    .ans.ok{background:#d1fae5;border-color:#34d399}

    /* CARDS */
    .big{font-size:64px;font-weight:900;margin:8px 0 6px}

    /* ACCENT */
    .stat{background:#f5f7fc;border-radius:14px;padding:12px 14px;margin-top:8px}

    /* GAME */
    .arena{aspect-ratio:16/9;background:#e9eef6;border-radius:18px;position:relative;overflow:hidden;border:1px solid #e6ebf4}
    .cell{position:absolute;border:1px solid rgba(0,0,0,.04)}
    .sprite{position:absolute;transform:translate(-50%,-50%);filter:drop-shadow(0 3px 6px rgba(0,0,0,.15))}
    .lives{position:absolute;top:10px;right:16px;font-size:20px}
    .gameover{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:28px;color:#111827}
    @media (max-width:720px){
      .quiz-word,.big{font-size:44px}
      .grid4{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <div id="root"><div class="wrap"><h1>üê≠ Mouse & Cheese</h1><p>Loading‚Ä¶</p></div></div>

  <!-- React 18 + ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- In‚Äëbrowser JSX compiler for a single-file demo -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
  const {useState,useEffect,useRef,useMemo,useCallback} = React;

  // Helpers
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const rand=n=>Math.floor(Math.random()*n);

  // Speak TTS
  function speak(text){
    try{ const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; u.rate=0.95; speechSynthesis.speak(u);}catch(e){}
  }

  // String similarity (very rough) for Accent
  function similarity(a,b){
    a=(a||'').toLowerCase(); b=(b||'').toLowerCase();
    if(!a||!b) return 0; const m=Math.max(a.length,b.length);
    let s=0; for(let i=0;i<Math.min(a.length,b.length);i++){ if(a[i]===b[i]) s++; }
    return Math.round((s/m)*100);
  }

  // Words
  const WORDS=[
    {en:'cheese',ru:'—Å—ã—Ä'},{en:'room',ru:'–∫–æ–º–Ω–∞—Ç–∞'},{en:'right',ru:'–ø—Ä–∞–≤–æ'},{en:'child',ru:'—Ä–µ–±—ë–Ω–æ–∫'},
    {en:'ticket',ru:'–±–∏–ª–µ—Ç'},{en:'left',ru:'–ª–µ–≤–æ'},{en:'school',ru:'—à–∫–æ–ª–∞'},{en:'game',ru:'–∏–≥—Ä–∞'}
  ];

  // --- UI atoms
  const Btn = ({children,onClick,className='',variant='ghost'})=>{
    const map={grad:'btn btn--grad', ok:'btn btn--ok', ghost:'btn btn--ghost'};
    return <button className={map[variant]} onClick={onClick}>{children}</button>
  };

  // --- Game component
  function Game({onBack,onSpeakWord,word}){
    const COLS=18, ROWS=12, CELL=38, SPEED=280, MAX_LIVES=3;
    const wrapRef=useRef(null);
    const [running,setRunning]=useState(true);
    const [mouse,setMouse]=useState({x:1,y:1});
    const [cheese,setCheese]=useState({x:6,y:4});
    const [dir,setDir]=useState({x:1,y:0});
    const [lives,setLives]=useState(MAX_LIVES);
    const [obstacles,setObstacles]=useState(()=>{
      const K=6; const a=[]; const pool=['üåµ','ü™µ','ü™®','üï≥Ô∏è','üßä'];
      for(let i=0;i<K;i++) a.push({x:rand(COLS-2)+1,y:rand(ROWS-2)+1,em:pool[rand(pool.length)]});
      return a;
    });

    // Swipe & tap
    useEffect(()=>{
      const el=wrapRef.current; if(!el) return;
      let sx=0,sy=0, ex=0,ey=0;
      const touchstart=e=>{ const t=e.touches[0]; sx=t.clientX; sy=t.clientY; };
      const touchend=e=>{ const t=e.changedTouches[0]; ex=t.clientX; ey=t.clientY; const dx=ex-sx, dy=ey-sy; if(Math.abs(dx)>Math.abs(dy)) setDir({x:Math.sign(dx),y:0}); else setDir({x:0,y:Math.sign(dy)}); };
      el.addEventListener('touchstart',touchstart,{passive:true});
      el.addEventListener('touchend',touchend,{passive:true});
      const click=e=>{ // tap turns towards cheese
        const dx=cheese.x-mouse.x, dy=cheese.y-mouse.y; if(Math.abs(dx)>Math.abs(dy)) setDir({x:Math.sign(dx),y:0}); else setDir({x:0,y:Math.sign(dy)});
      };
      el.addEventListener('click',click);
      return ()=>{ el.removeEventListener('touchstart',touchstart); el.removeEventListener('touchend',touchend); el.removeEventListener('click',click); };
    },[mouse,cheese]);

    // Auto movement
    useEffect(()=>{
      if(!running) return;
      const id=setInterval(()=>{
        setMouse(prev=>{
          let nx=prev.x+dir.x, ny=prev.y+dir.y;
          // collisions with walls
          if(nx<0||ny<0||nx>=COLS||ny>=ROWS){ setLives(v=>v-1); speak('ouch'); return prev; }
          // obstacles
          if(obstacles.some(o=>o.x===nx && o.y===ny)){ setLives(v=>v-1); speak('ouch'); return prev; }
          // cheese
          if(nx===cheese.x && ny===cheese.y){
            // new cheese
            setCheese({x:rand(COLS),y:rand(ROWS)});
            setLives(v=>clamp(v+1,0,MAX_LIVES));
            onSpeakWord && onSpeakWord(word.en);
          }
          return {x:nx,y:ny};
        });
      },SPEED);
      return ()=>clearInterval(id);
    },[dir,cheese,obstacles,running,word]);

    useEffect(()=>{ if(lives<=0){ setRunning(false); } },[lives]);

    // Layout helpers
    const w=COLS*CELL, h=ROWS*CELL;
    const grid=Array.from({length:COLS*ROWS},(_,i)=>({x:i%COLS,y:Math.floor(i/COLS)}));

    return (
      <div className="panel">
        <div className="row" style={{marginBottom:10}}>
          <div className="title">Mouse & Cheese</div>
          <div className="lives">{'‚ù§'.repeat(lives)+ 'ü§ç'.repeat(MAX_LIVES-lives)}</div>
        </div>
        <div ref={wrapRef} className="arena" style={{width:w}}>
          {/* grid light lines */}
          {grid.map(c=> (
            <div key={`${c.x}-${c.y}`} className="cell" style={{left:c.x*CELL,top:c.y*CELL,width:CELL,height:CELL}}></div>
          ))}
          {/* sprites */}
          {running && <div className="sprite" style={{left:(mouse.x+.5)*CELL, top:(mouse.y+.5)*CELL, fontSize:28}}>üê≠</div>}
          <div className="sprite" style={{left:(cheese.x+.5)*CELL, top:(cheese.y+.5)*CELL, fontSize:26}}>üßÄ</div>
          {obstacles.map((o,i)=> (
            <div key={i} className="sprite" style={{left:(o.x+.5)*CELL, top:(o.y+.5)*CELL, fontSize:24}}>{o.em}</div>
          ))}
          {!running && <div className="gameover">Game Over</div>}
        </div>
        <div className="row" style={{marginTop:10,justifyContent:'space-between'}}>
          <Btn onClick={()=>{ setMouse({x:1,y:1}); setDir({x:1,y:0}); setLives(MAX_LIVES); setCheese({x:6,y:4}); setRunning(true); }}>Restart</Btn>
          <div className="subtitle">Swipe to move. Tap to turn towards cheese. Eat cheese ‚Äî ‚Äúbeep‚Äù and the word.</div>
        </div>
      </div>
    );
  }

  // --- Quiz
  function Quiz({onBack}){
    const [i,setI]=useState(0);
    const [ok,setOk]=useState(null);
    const q=WORDS[i%WORDS.length];
    const opts=useMemo(()=>{
      const pool=[q.ru];
      while(pool.length<4){ const r=WORDS[rand(WORDS.length)].ru; if(!pool.includes(r)) pool.push(r); }
      return pool.sort(()=>Math.random()-0.5);
    },[i]);

    const choose=v=>{ const is=v===q.ru; setOk(v); if(is) speak(q.en); };
    const next=()=>{ setOk(null); setI(v=>v+1); };

    return (
      <div className="panel">
        <div className="row"><div className="title">Quiz ‚Äî choose translation</div><Btn onClick={onBack}>Menu</Btn><Btn variant="grad" onClick={next}>Next</Btn></div>
        <div className="quiz-word">{q.en}</div>
        <div className="grid4">
          {opts.map(v=> (
            <div key={v} className={"ans"+(ok===v && v===q.ru?" ok":"")} onClick={()=>choose(v)}>{v}</div>
          ))}
        </div>
      </div>
    );
  }

  // --- Cards
  function Cards({onBack}){
    const [i,setI]=useState(0);
    const [show,setShow]=useState(false);
    const w=WORDS[i%WORDS.length];
    return (
      <div className="panel">
        <div className="row"><div className="title">Cards</div><Btn onClick={onBack}>Menu</Btn></div>
        <div className="big">{w.en}</div>
        {show && <div className="subtitle" style={{fontSize:18}}>{w.ru}</div>}
        <div className="card-row" style={{marginTop:12}}>
          <Btn onClick={()=>setShow(s=>!s)}>{show? 'Hide RU':'Show RU'}</Btn>
          <Btn onClick={()=>speak(w.en)}>Speak</Btn>
          <Btn variant="ok" onClick={()=>{ setI(v=>v+1); setShow(false); }}>Know</Btn>
          <Btn onClick={onBack}>Menu</Btn>
        </div>
      </div>
    );
  }

  // --- Accent (pronunciation)
  function Accent({onBack}){
    const [i,setI]=useState(0);
    const [heard,setHeard]=useState('‚Äî');
    const [match,setMatch]=useState(0);
    const w=WORDS[i%WORDS.length];

    const listen=()=> speak(w.en);
    const say=()=>{
      const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!Rec){ alert('SpeechRecognition not supported in this browser'); return; }
      const r=new Rec(); r.lang='en-US'; r.interimResults=false; r.maxAlternatives=1;
      r.onresult=e=>{ const txt=(e.results[0][0].transcript||'').trim(); setHeard(txt); setMatch(similarity(txt,w.en)); };
      r.onerror=()=>setHeard('‚Äî'); r.start();
    };

    return (
      <div className="panel">
        <div className="row"><div className="title">Accent ‚Ä¢ say the word as close to original</div><Btn onClick={onBack}>Menu</Btn></div>
        <div className="big">{w.en}</div>
        <div className="subtitle">{w.ru}</div>
        <div className="card-row" style={{marginTop:12}}>
          <Btn onClick={listen}>Listen</Btn>
          <Btn variant="grad" onClick={say}>Say (browser)</Btn>
          <Btn variant="ok" onClick={()=>{ setI(v=>v+1); setHeard('‚Äî'); setMatch(0); }}>Next</Btn>
        </div>
        <div className="card-row" style={{marginTop:12}}>
          <div className="stat">Microphone access: ready</div>
          <div className="stat">Heard: {heard} ‚Ä¢ Match: {match}%</div>
        </div>
      </div>
    );
  }

  // --- Main Menu
  function Menu({go}){
    // fake metrics
    const [stats,setStats]=useState({cards:0,quiz:0,cheese:0,accent:0,day:1});
    return (
      <>
        <div className="row" style={{alignItems:'flex-start', gap:14}}>
          <h1>üê≠ Mouse & Cheese</h1>
          <div className="topbar"><Btn onClick={()=>document.body.classList.toggle('dark')}>Theme</Btn><Btn onClick={()=>go('menu')}>Menu</Btn></div>
        </div>
        <div className="panel">
          <div className="row">
            <div className="title">Goal: 20/day</div>
            <div className="subtitle">Move toward your goal ‚Äî practice every day.</div>
          </div>
          <div className="grid4" style={{marginTop:10}}>
            <div className="metric"><b>{stats.cards}</b><div>Cards</div></div>
            <div className="metric"><b>{stats.quiz}</b><div>Quiz</div></div>
            <div className="metric"><b>{stats.cheese}</b><div>Cheese</div></div>
            <div className="metric"><b>{stats.accent}</b><div>Accent</div></div>
          </div>
        </div>

        <div className="panel"><div className="row"><div className="title">Quiz</div><Btn variant="grad" onClick={()=>go('quiz')}>Open ‚Üí</Btn></div><div className="subtitle">Pick the correct translation</div></div>
        <div className="panel"><div className="row"><div className="title">Cards</div><Btn variant="grad" onClick={()=>go('cards')}>Open ‚Üí</Btn></div><div className="subtitle">EN ‚áÑ RU. ‚ÄúKnow‚Äù adds to learned</div></div>
        <div className="panel"><div className="row"><div className="title">Game</div><Btn variant="grad" onClick={()=>go('game')}>Open ‚Üí</Btn></div><div className="subtitle">Eat cheese ‚Äî beep + word</div></div>
        <div className="panel"><div className="row"><div className="title">Accent</div><Btn variant="grad" onClick={()=>go('accent')}>Train ‚Üí</Btn></div><div className="subtitle">Say the word close to native</div></div>

        <div className="nav">
          <button onClick={()=>go('quiz')}>üß†</button>
          <button onClick={()=>go('cards')}>üÉè</button>
          <button onClick={()=>go('game')}>üéÆ</button>
          <button onClick={()=>go('accent')}>üí¨</button>
        </div>
      </>
    );
  }

  function App(){
    const [screen,setScreen]=useState('menu');
    const [wordI,setWordI]=useState(0);
    const word=WORDS[wordI%WORDS.length];
    const nextWord=()=>setWordI(i=>i+1);

    const go=useCallback((s)=>setScreen(s),[]);

    return (
      <div className="wrap">
        {screen==='menu' && <Menu go={go}/>}        
        {screen==='quiz' && <Quiz onBack={()=>go('menu')}/>}        
        {screen==='cards' && <Cards onBack={()=>go('menu')}/>}        
        {screen==='accent' && <Accent onBack={()=>go('menu')}/>}        
        {screen==='game' && <Game onBack={()=>go('menu')} onSpeakWord={speak} word={word}/>}        
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
